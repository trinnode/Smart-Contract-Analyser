<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- You can change the page title here -->
    <title>Smart Contract Analyzer</title>
    
    <!-- Using Tailwind CSS for a modern look. No setup needed. -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Using the Inter font for clean typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* A few custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Simple spinner animation */
        .spinner {
            border-color: transparent;
            border-top-color: #4f46e5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Custom styling for the select dropdown */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%239ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem; /* Make space for the arrow */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-2xl mx-auto p-4 sm:p-6 md:p-8">
        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-2xl shadow-2xl shadow-black/20 overflow-hidden">
            <div class="p-6 md:p-8">
                <!-- App Header -->
                <div class="text-center mb-6">
                    <h1 class="text-3xl font-bold text-white">Smart Contract Analyzer</h1>
                    <p class="text-gray-400 mt-2">Enter a contract address to detect its implemented ERC/EIP standards.</p>
                </div>

                <!-- Input Form -->
                <div class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="md:col-span-2">
                             <input type="text" id="contractAddress" placeholder="Enter Contract Address (e.g., 0x...)" class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition duration-200">
                        </div>
                        <div>
                             <select id="networkSelector" class="w-full h-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition duration-200">
                                <!-- Network options will be populated by JS -->
                             </select>
                        </div>
                    </div>
                    <button id="checkButton" class="w-full bg-indigo-600 text-white font-semibold rounded-lg px-6 py-3 hover:bg-indigo-500 active:bg-indigo-700 transition duration-200 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                        <svg id="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"></path></svg>
                        <span id="button-text">Analyze</span>
                    </button>
                </div>
            </div>
            
            <!-- Results Section -->
            <div id="results" class="bg-gray-900/60 p-6 md:p-8 border-t border-gray-700/50 min-h-[200px] flex items-center justify-center">
                <!-- Initial State -->
                <div id="initial-state" class="text-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M10 21h7a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v11m0 5l4.879-4.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242z" /></svg>
                    <p class="mt-2">Results will appear here.</p>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="hidden text-center text-gray-400">
                    <div class="spinner w-10 h-10 rounded-full border-4 mx-auto"></div>
                    <p class="mt-4 font-medium">Analyzing contract on-chain...</p>
                </div>

                <!-- Error State -->
                <div id="error-state" class="hidden text-center text-red-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <p id="error-message" class="mt-2 font-semibold">An error occurred.</p>
                </div>

                <!-- Success State -->
                <div id="success-state" class="hidden w-full">
                    <h3 class="text-lg font-semibold text-white mb-1">Analysis for:</h3>
                    <p id="checked-address" class="text-sm text-indigo-400 font-mono break-all mb-4"></p>
                    <div id="results-list" class="space-y-3">
                        <!-- Results will be injected here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center mt-6 text-sm text-gray-500">
            <!-- You can change the footer name or link here -->
            <p>Built for seamless smart contract analysis.</p>
        </footer>
    </div>

    <!-- Ethers.js library for blockchain interaction -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>

    <script>
        // =================================================================================
        // CONFIGURATION
        // Add or remove networks here. Use your own RPC URLs for better performance.
        // Public RPCs are provided as a default but may be rate-limited.
        // =================================================================================
        const networks = {
            "ethereum": {
                name: "Ethereum",
                rpcUrl: "https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
            },
            "polygon": {
                name: "Polygon",
                rpcUrl: "https://polygon-rpc.com/",
            },
            "arbitrum": {
                name: "Arbitrum",
                rpcUrl: "https://arb1.arbitrum.io/rpc",
            },
            "optimism": {
                name: "Optimism",
                rpcUrl: "https://mainnet.optimism.io",
            },
            "bsc": {
                name: "BNB Chain",
                rpcUrl: "https://bsc-dataseed.binance.org/",
            },
            "avalanche": {
                name: "Avalanche",
                rpcUrl: "https://api.avax.network/ext/bc/C/rpc",
            }
        };

        // =================================================================================
        // ERC/EIP STANDARDS DEFINITIONS
        // This is the knowledge base of the analyzer. You can add more standards here.
        // `type`: 'ERC165' uses supportsInterface. 'BYTECODE' checks function selectors.
        // `requiredSelectorPercentage`: For BYTECODE, the minimum % of selectors that must match.
        // =================================================================================
        const standards = [
            {
                name: 'ERC-20',
                type: 'BYTECODE',
                selectors: ['a9059cbb', '18160ddd', '70a08231', '23b872dd', '095ea7b3', 'dd62ed3e'],
                requiredSelectorPercentage: 80, // Needs most functions like transfer, balanceOf, etc.
                description: 'A standard for fungible tokens (like stablecoins or utility tokens).'
            },
            {
                name: 'ERC-721',
                type: 'ERC165',
                interfaceId: '0x80ac58cd',
                description: 'A standard for non-fungible tokens (NFTs), where each token is unique.'
            },
            {
                name: 'ERC-1155',
                type: 'ERC165',
                interfaceId: '0xd9b67a26',
                description: 'A multi-token standard that can represent both fungible and non-fungible tokens.'
            },
            {
                name: 'ERC-721 Metadata',
                type: 'ERC165',
                interfaceId: '0x5b5e139f',
                description: 'Optional extension for ERC-721 that adds token names, symbols, and URIs.'
            },
            {
                name: 'ERC-4906',
                type: 'ERC165',
                interfaceId: '0x49064906',
                description: 'Standard for emitting a single event when NFT metadata is updated.'
            },
            {
                name: 'ERC-2981',
                type: 'ERC165',
                interfaceId: '0x2a55205a',
                description: 'A standard for handling royalty payments for NFTs.'
            }
        ];

        // =================================================================================
        // APPLICATION LOGIC
        // =================================================================================
        
        // DOM Elements
        const contractAddressInput = document.getElementById('contractAddress');
        const networkSelector = document.getElementById('networkSelector');
        const checkButton = document.getElementById('checkButton');
        const buttonText = document.getElementById('button-text');
        const buttonIcon = document.getElementById('button-icon');
        
        const initialState = document.getElementById('initial-state');
        const loadingState = document.getElementById('loading-state');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');
        const successState = document.getElementById('success-state');
        const checkedAddressEl = document.getElementById('checked-address');
        const resultsList = document.getElementById('results-list');

        // Initialize the network selector on page load
        document.addEventListener('DOMContentLoaded', () => {
            for (const [key, network] of Object.entries(networks)) {
                const option = document.createElement('option');
                option.value = network.rpcUrl;
                option.textContent = network.name;
                networkSelector.appendChild(option);
            }
        });

        // Event Listeners
        checkButton.addEventListener('click', handleCheck);
        contractAddressInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleCheck();
            }
        });

        // Main handler function
        async function handleCheck() {
            const address = contractAddressInput.value.trim();
            const rpcUrl = networkSelector.value;

            if (!ethers.utils.isAddress(address)) {
                showError('Invalid Ethereum address provided.');
                return;
            }
            
            if (!rpcUrl) {
                showError('Please select a network.');
                return;
            }

            setLoading(true);

            try {
                // Initialize provider dynamically based on selection
                const provider = new ethers.providers.JsonRpcProvider(rpcUrl);

                const bytecode = await provider.getCode(address);
                if (bytecode === '0x') {
                    showError('This address is not a smart contract.');
                    return;
                }

                const checkPromises = standards.map(standard => {
                    if (standard.type === 'ERC165') {
                        return checkERC165(address, standard, provider);
                    } else if (standard.type === 'BYTECODE') {
                        return checkBytecode(bytecode, standard);
                    }
                    return Promise.resolve({ ...standard, detected: false });
                });

                const results = await Promise.all(checkPromises);
                displayResults(address, results);

            } catch (err) {
                console.error('An error occurred during analysis:', err);
                showError('Could not fetch contract data. The network may be busy or the RPC endpoint is down.');
            } finally {
                setLoading(false);
            }
        }
        
        // --- CHECKER FUNCTIONS ---

        async function checkERC165(address, standard, provider) {
            const erc165Abi = ["function supportsInterface(bytes4 interfaceId) external view returns (bool)"];
            const contract = new ethers.Contract(address, erc165Abi, provider);
            try {
                const supports = await contract.supportsInterface(standard.interfaceId);
                return { ...standard, detected: supports };
            } catch (error) {
                // This error is expected if the contract doesn't implement ERC165
                return { ...standard, detected: false };
            }
        }

        async function checkBytecode(bytecode, standard) {
            let matches = 0;
            // The bytecode includes '0x' prefix, so we search without it
            const cleanBytecode = bytecode.substring(2);
            standard.selectors.forEach(selector => {
                if (cleanBytecode.includes(selector)) {
                    matches++;
                }
            });
            const percentage = (matches / standard.selectors.length) * 100;
            return { ...standard, detected: percentage >= standard.requiredSelectorPercentage };
        }

        // --- UI HELPER FUNCTIONS ---

        function setLoading(isLoading) {
            checkButton.disabled = isLoading;
            contractAddressInput.disabled = isLoading;
            networkSelector.disabled = isLoading;
            
            initialState.classList.add('hidden');
            errorState.classList.add('hidden');
            successState.classList.add('hidden');

            if (isLoading) {
                loadingState.classList.remove('hidden');
                buttonText.textContent = 'Analyzing...';
                buttonIcon.innerHTML = `<path d="M21 12a9 9 0 1 1-6.219-8.56"/>`; // Loading spinner icon
            } else {
                loadingState.classList.add('hidden');
                buttonText.textContent = 'Analyze';
                buttonIcon.innerHTML = `<path d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"></path>`; // Search icon
            }
        }

        function showError(message) {
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            successState.classList.add('hidden');
            errorState.classList.remove('hidden');
            errorMessage.textContent = message;
        }

        function displayResults(address, results) {
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            successState.classList.remove('hidden');

            checkedAddressEl.textContent = address;
            resultsList.innerHTML = ''; // Clear previous results

            results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = `p-4 rounded-lg flex items-start gap-4 transition-all ${result.detected ? 'bg-green-500/10 border border-green-500/20' : 'bg-gray-700/30 border border-gray-700/50'}`;
                
                const icon = result.detected 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>` 
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;

                resultElement.innerHTML = `
                    ${icon}
                    <div>
                        <h4 class="font-semibold text-white">${result.name}</h4>
                        <p class="text-sm text-gray-400">${result.description}</p>
                    </div>
                `;
                resultsList.appendChild(resultElement);
            });
        }
    </script>
</body>
</html>

